# –ü–ª–∞—Ç—Ñ–æ–º–∞ –≤–∏–¥–∂–µ—Ç–æ–≤

- —à–∞—Ä–∏–Ω–≥ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ npm –ø–∞–∫–µ—Ç
- –ø–µ—Å–æ—á–Ω–∏—Ü–∞ —Å HMR –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞
- –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π vite
- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è npm-loader
- preview —Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞
- –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –±–∞–Ω–¥–ª–∞
- –∏–∑–æ–ª—è—Ü–∏—è –±–∞–Ω–¥–ª–∞ —á–µ—Ä–µ–∑ same-origin iframe

### –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç

–ú—ã —Å—Ç—Ä–µ–º–∏–º—Å—è —É–∑–Ω–∞—Ç—å, –µ—Å—Ç—å –ª–∏ –≤ open source –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —Ç–∞–∫–æ–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏. –ï—Å–ª–∏ –≤—ã –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª–∏—Å—å, –¥–∞–π—Ç–µ –Ω–∞–º –∑–Ω–∞—Ç—å: –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥–æ—á–∫—É –≤ github, –æ—Å—Ç–∞–≤—å—Ç–µ issue, –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ –≤ telegram [@vtolstikov](https://t.me/vtolstikov).

### –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

–í—ã–ø–æ–ª–Ω–∏ –∏–∑ –∫–æ—Ä–Ω—è:

```
npm install && npm run build
```

–ó–∞—Ç–µ–º –∏–∑ –ø–∞–ø–∫–∏ `packages/template` –≤—ã–ø–æ–ª–Ω–∏:

```
npm start
```

–í –∫–æ–Ω—Å–æ–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è —É—Ä–ª, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø–µ—Å–æ—á–Ω–∏—Ü–µ–π –∏ –≤–∏–¥–∂–µ—Ç–æ–º.

–ë—Ä–∞—É–∑–µ—Ä –Ω–µ —Å–º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, —Ç.–∫. –æ–Ω –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä—Ç—É, –∫–æ—Ç–æ—Ä—ã–π –≤ –ø—Ä–æ–µ–∫—Ç–µ. –ù—É–∂–Ω–æ –ª–∏–±–æ –¥–æ–≤–µ—Ä–∏—Ç—Å—è —Å–µ—Ä—Ç—É, –ª–∏–±–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π.

–ß—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π:
1. –°–¥–µ–ª–∞—Ç—å –∫–∞–∫ –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç [—Ç—É—Ç](https://stackoverflow.com/a/41366949). –í–º–µ—Å—Ç–æ example.com –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å `localhost`.
2. –°–µ—Ä—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π. –°–µ—Ä—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `packages/https-test-certificate`

–î–∞–ª–µ–µ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ. –î–ª—è —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [—ç—Ç—É](https://pq.hosting/help/instructions/340-kak-ustanovit-sertifikaty-v-google-chrome.html) –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∏ Google Chrome.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è. –ß—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–∂–µ—Ç –Ω–∞–∂–º–∏—Ç–µ –¥–≤–∞ —Ç–æ–≥–ª–∞ "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç" –∏ "–û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç".

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—é –≤–∏–¥–∂–µ—Ç–∞

–û–ø–∏—Å–∞–Ω—ã –≤ [—Ç—É—Ç](./docs/demands.md).

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –≤–∏–¥–∂–µ—Ç–∞

- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ esm (type: module)
- Typescript >= 5

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≤–∏–¥–∂–µ—Ç

–ü–æ–¥–∫–ª—é—á–∏ –ø–∞–∫–µ—Ç

```
npm install @skbkontur/widget-platform
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã:

```
üì¶Project
 ‚îú üìÇ.platform
 ‚îÇ ‚îî üìúconfig.ts
 ‚îú üìÇexports
 ‚îÇ ‚îú üìúindex.ts
 ‚îÇ ‚îî üìúplatformTypes.ts
 ‚îú üìÇjsLoader
 ‚îÇ ‚îú üìúindex.ts
 ‚îÇ ‚îî üìúvite.config.ts
 ‚îú üìÇplayground
 ‚îÇ ‚îú üìúenvironmentConfigs.ts
 ‚îÇ ‚îú üìúindex.tsx
 ‚îÇ ‚îî üìúvite.config.ts
 ‚îú üìÇwidget
 ‚îÇ ‚îú üìúindex.tsx
 ‚îÇ ‚îî üìúvite.config.ts
 ‚îî üìúpackage.json
```


#### package.json

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è npm-loader –∏ –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞. –ü–æ–¥–∫–ª—é—á–∞–π –≤ dependencies —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ npm-loader. –û—Å—Ç–∞–ª—å–Ω–æ–µ - –≤ devDependencies. –¢–∞–∫–∂–µ –≤ dependencies –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª—É–∂–µ–±–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ npm-loader:
- @skbkontur/loader-builder
- @skbkontur/operation-result

–û—Å—Ç–æ—Ä–æ–∂–Ω–æ –º–µ–Ω—è–π –ø–æ–ª—è –≤ —ç—Ç–æ–º package.json, —Ç.–∫. –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞, –Ω–æ –∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ node_modules –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª–µ `sideEffects: false` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è npm –ø–∞–∫–µ—Ç–∞, –Ω–æ —Å–ª–æ–º–∞—Ç—å —Ä–∞–Ω—Ç–∞–π–º –≤–∏–¥–∂–µ—Ç–∞.

–ß—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å npm-loader –≤ –ø–µ—Å–æ—á–Ω–∏—Ü—É, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å —Å –∏–º–µ–Ω–µ–º –≤ —ç—Ç–æ–º package.json.

#### playground

–î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ñ–∞–π–ª `index.tsx?`. –≠—Ç–æ –≤—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞ –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø–µ—Å–æ—á–Ω–∏—Ü—ã. –î–æ–ª–∂–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞, `HTMLElement` –∏ —É—Ä–ª –≤–∏–¥–∂–µ—Ç–∞.

#### widget

–î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ñ–∞–π–ª `index.tsx?`. –≠—Ç–æ –≤—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞ –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞. –î–æ–ª–∂–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `createWidgetApi` –∫–∞–∫ `default`.

#### jsLoader

js-loader - —ç—Ç–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —á–∞–Ω–∫ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –≤–∏–¥–∂–µ—Ç–∞. –ù—É–∂–µ–Ω, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å same-origin iframe. –¢–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–¥–µ–ª–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

–ü–∞–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ñ–∞–π–ª `index.ts`. –≠—Ç–æ –≤—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞. –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç—ã `getJsLoaderDependencies` –∏ `generateCsp`.

`getJsLoaderDependencies` - –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –≤–∏–¥–∂–µ—Ç —Å–≤–æ–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ iframe.

`generateCsp` - –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ CSP.


#### config.ts

- `sharedModules` ‚Äì –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–∂–¥—É –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–º –∏ –≤–∏–¥–∂–µ—Ç–æ–º. –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —á–∏—Ç–∞–π –≤ [—Å—Ç–∞—Ç—å–µ](https://staff.skbkontur.ru/article/64f62798fa36a404535ac105#stanpm). –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç window. –ü–∞–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ [dependencies](#dependencies) package.json.
  –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –≤–µ—Ä—Å–∏—é –ø–∞–∫–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –¥–µ–ª–∞–π —ç—Ç–æ –ø–æ [–≥–∞–π–¥—É](#–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π).
- `playground:`
  - `port` - –ø–æ—Ä—Ç –¥–ª—è dev-server
  - `checkersConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è [vite-plugin-checker](https://www.npmjs.com/package/vite-plugin-checker).
- `jsLoader:`
  - `sharedModules` -  –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `sharedModules` –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ, –≤ –∫–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: `namespace`, `imports`
  - `checkersConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è [vite-plugin-checker](https://www.npmjs.com/package/vite-plugin-checker).
- `widget`
  - `checkersConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è [vite-plugin-checker](https://www.npmjs.com/package/vite-plugin-checker).

#### vite.config.ts
–ù–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.

–ï—Å–ª–∏ –≤–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ vite, —Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª vite.config.ts –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ø–∞–ø–∫—É. –≠—Ç–æ—Ç –∫–æ–Ω—Ñ–∏–≥ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –Ω–∞–π—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –ü–µ—Ä–µ–∑–∞–ø–∏—à—É—Ç—Å—è –Ω–µ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∞ —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ. –í–æ—Ç —Ç–∞–∫ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ñ–∞–π–ª:

```ts
import {defineConfig} from 'vite'

export default defineConfig(_config => ({
  server: {
    port: 5555
  }
}))
```

–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å outDir, —Ç.–∫. –º–æ–∂–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥–∞ `preview`. –õ—É—á—à–µ —Å–¥–µ–ª–∞—Ç—å –±–∞—Ç–Ω–∏–∫ –≤ –ø—Ä–æ–µ–∫—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π —Å–∫–æ–ø–∏—Ä—É–µ—Ç —Å–∫—Ä–∏–ø—Ç—ã –∫—É–¥–∞ –Ω–∞–¥–æ.

#### exports

–ü–∞–ø–∫–∞ –¥–ª—è npm-loader.

–í–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è npm-loader. –í –Ω–µ–º —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ `importWidgetModule`. –ß—Ç–æ–±—ã –æ–Ω –±—ã–ª —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ —Ç–∏–ø—ã –≤ —Ñ–∞–π–ª–µ `platformTypes.ts`.

–ß—Ç–æ–±—ã —ç–∫–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∏–ø—ã –≤ npm-loader, –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏—Ö –≤ —Ñ–∞–π–ª–µ `index.ts`

–ï—Å–ª–∏ –µ—Å—Ç—å —Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è `index.ts`, –Ω–æ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –Ω—É–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å, —Å–æ–∑–¥–∞–π –∏—Ö –≤ –¥—Ä—É–≥–æ–º —Ñ–∞–π–ª–µ.

#### environmentConfigs.ts

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Å–æ—á–Ω–∏—Ü—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚Äî —Ñ—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

–ü—Ä–∏–º–µ—Ä:
```ts
// playground/environmentConfigs.ts
import type { GetPlaygroundDevConfig, GetPlaygroundEnvironmentConfig } from "@skbkontur/widget-platform/browser";

type MyEnvironmentConfig = { apiUrl: URL };

export const getDevConfig: GetPlaygroundDevConfig<MyEnvironmentConfig> = async () => {
  return {
    environmentConfig: {
      apiUrl: new URL("https://internal.domain.ru/template-widget/api/"), // –ª–æ–∫–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±–ª–∞—á–Ω—ã–π
    },
  };
};

export const getCloudConfig: GetPlaygroundEnvironmentConfig<MyEnvironmentConfig> = async () => {
  return {
    loaderUrlPrefix: new URL("./widget/", window.location.href),
    environmentConfig: {
      apiUrl: new URL("./api/", window.location.href), // —É—Ä–ª –¥–æ –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ —Ç–µ–∫—É—â–µ–π –ø–ª–æ—â–∞–¥–∫–µ —Å –≤–∏–¥–∂–µ—Ç–æ–º
    },
  };
};

export const getProdConfig: GetPlaygroundEnvironmentConfig<EnvironmentConfig> = async () => {
  return {
    loaderUrlPrefix: new URL("./widget/", window.location.href),
    environmentConfig: {
      apiUrl: new URL("https://domain.ru/template-widget/api/"),
    },
  };
};
```

##### –ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ñ—É–Ω–∫—Ü–∏–∏

- `loaderUrlPrefix` ‚Äî —É—Ä–ª –¥–æ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–Ω–æ–π –ø–∞–ø–∫–∏ —Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏ –≤–∏–¥–∂–µ—Ç–∞. –ü–ª–µ–π–≥—Ä–∞—É–Ω–¥ –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –ª–æ—É–¥–µ—Ä –≤–∏–¥–∂–µ—Ç–∞ –ø–æ —É—Ä–ª—É `${loaderUrlPrefix}/loader.js`.
- `environmentConfig` ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–µ–π–≥—Ä–∞—É–Ω–¥–∞. –ò—Ö —Ç–∏–ø —Ç—ã –∑–∞–¥–∞–µ—à—å —Å–∞–º ‚Äî —Å–º–æ—Ç—Ä—è —á—Ç–æ —Ö–æ—á–µ—à—å –º–µ–Ω—è—Ç—å –º–µ–∂–¥—É –ø–ª–æ—â–∞–¥–∫–∞–º–∏: —É—Ä–ª—ã, –∞–ø–∏-–∫–ª—é—á–∏.

`environmentConfig` –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ [`renderPlayground`](#playground) –≤ –ø–æ–ª–µ `environmentConfig`, –∞ —É—Ä–ª –¥–æ –ª–æ—É–¥–µ—Ä–∞ –≤–∏–¥–∂–µ—Ç–∞ `${loaderUrlPrefix}/loader.js` ‚Äî –≤ –ø–æ–ª–µ `widgetUrl`.

##### –ö–∞–∫–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±—ã–≤–∞—é—Ç

–§—É–Ω–∫—Ü–∏—è `getDevConfig` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—Å–µ–≥–¥–∞, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –Ω–µ–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è, –∫–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—à—å `widget-platform start`, `preview` –∏–ª–∏ `watch`. –í `getDevConfig` –ø–æ–ª–µ `loaderUrlPrefix` –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ: –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —É—Ä–ª–æ–º —Ä–∞–∑–¥–∞—á–∏ –≤–∏–¥–∂–µ—Ç–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∞–º–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞.

–û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ç—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—à—å —Å–∞–º, –≤ `.platform/config.ts`. –í –æ–±—ä–µ–∫—Ç–µ `playground.htmlConfigs` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É–∫–∞–∂–∏:
- –∫–ª—é—á ‚Äî –∏–º—è html-–∫–∏, —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –≤ –ø–ª–µ–π–≥—Ä–∞—É–Ω–¥ –≤ —ç—Ç–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏,
- –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `environmentConfigs.ts` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —ç—Ç–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

```ts
// .platform/config.ts
export default (): Config => ({
  ...
  playground: {
    htmlConfigs: {
      "index.cloud.html": "getCloudConfig",
      "index.prod.html": "getProdConfig",
    },
    ...
  },
})
```
##### Html-–∫–∏ –ø–ª–µ–π–≥—Ä–∞—É–Ω–¥–∞

–ö–æ–º–∞–Ω–¥–∞ `widget-platform build` —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∞–π–ª `index.{env}.html` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `playground.htmlConfigs` –∏ –ø–æ–ª–æ–∂–∏—Ç –µ–≥–æ –≤ `.artifacts/playground/`. –ö–∞–∂–¥—ã–π `index.{env}.html` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–ª–µ–π–≥—Ä–∞—É–Ω–¥ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å–≤–æ–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

##### –ü–µ—Ä–µ–¥–∞—á–∞ —É—Ä–ª–æ–≤ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫

–ü—Ä–∏–º–µ—Ä:
–ù–∞ –∫–∞–∂–¥—É—é –≤–µ—Ç–∫—É –º–æ–Ω–æ—Ä–µ–ø—ã —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞ —Å–æ —Å–≤–æ–∏–º–∏ –¥–æ–º–µ–Ω–∞–º–∏, –æ—Ç–¥–µ–ª—å–Ω–æ ‚Äî –¥–ª—è –∞–ø–∏, –æ—Ç–¥–µ–ª—å–Ω–æ ‚Äî –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏, –æ—Ç–¥–µ–ª—å–Ω–æ ‚Äî –¥–ª—è –ø–ª–µ–π–≥—Ä–∞—É–Ω–¥–∞:

- `https://my-widget-{branch123}.domain.ru/loader.js` ‚Äî –ª–æ—É–¥–µ—Ä
- `https://my-playground-{branch123}.domain.ru/` ‚Äî –ø–ª–µ–π–≥—Ä–∞—É–Ω–¥
- `https://my-api-{branch123}.domain.ru/` ‚Äî –ê–ü–ò

–ß—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –≤—Å–µ –≤–µ—Ç–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ, —Å–æ–∑–¥–∞–π –¥–ª—è –Ω–∏—Ö –æ–¥–Ω–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Å–ª—è–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ `window.location.href`:

```ts
export const getStagingConfig: GetPlaygroundEnvironmentConfig<MyEnvironmentConfig> = async () => {
  const branch = extractBranchName(window.location.href);
  return {
    loaderUrlPrefix: new URL(`https://my-widget-${branch}.domain.ru/`),
    environmentConfig: {
      apiUrl: new URL(`https://my-api-${branch}.domain.ru/`),
    },
  };
};
```

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω —É—Ä–ª –Ω–∞ —Ç–æ–º –∂–µ –¥–æ–º–µ–Ω–µ, —á—Ç–æ –∏ –ø–ª–µ–π–≥—Ä–∞—É–Ω–¥, —Å–æ–∑–¥–∞–≤–∞–π –µ–≥–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ `window.location.href`:
```ts
    environmentConfig: {
      apiUrl: new URL("./api/", window.location.href),
    },
```

##### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

`environmentConfigs.ts` ‚Äî —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–æ—Å–æ–±–∞ "–Ω–µ—Å–∫–æ–ª—å–∫–æ `index.<env>.html` –≤ –±–∞–Ω–¥–ª–µ". –ß—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ, –æ—Å—Ç–∞–≤—å –≤ `environmentConfigs.ts` –ø—É—Å—Ç–æ–π `getDevConfig` –∏ `getIndexHtmlConfig` —Å `loaderUrlPrefix` –∏ –≤—ã—á–∏—Å–ª—è–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `renderPlayground` –ø–æ-–¥—Ä—É–≥–æ–º—É:

```ts
// playground/environmentConfigs.ts
import type { GetPlaygroundDevConfig, GetPlaygroundEnvironmentConfig } from "@skbkontur/widget-platform/browser";

export const getDevConfig: GetPlaygroundDevConfig = async () => {
  return { environmentConfig: undefined };
};

export const getIndexHtmlConfig: GetPlaygroundEnvironmentConfig<EnvironmentConfig> = async () => {
  return {
    loaderUrlPrefix: new URL("./widget/", window.location.href),
    environmentConfig: undefined,
  };
};

// .platform/config.ts
export default (): Config => ({
  ...
  playground: {
    htmlConfigs: {
      "index.html": "getIndexHtmlConfig",
    },
    ...
  },
})
```

##### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å–∞–º–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞

`environmentConfigs.ts` —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ –ø–ª–µ–π–≥—Ä–∞—É–Ω–¥–µ –∏ –Ω–∏–∫–∞–∫ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –≤–∏–¥–∂–µ—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π. –ß—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤ —ç—Ç–∏—Ö —Å–ª—É—á–∞—è—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–π –∏—Ö —Å –±—ç–∫–∞ –≤ –ê–ü–ò –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã.

### –ö–æ–º–∞–Ω–¥—ã

**start** ‚Äî —Å–æ–∑–¥–∞–µ—Ç vite server —á–µ—Ä–µ–∑ js api. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. HMR —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –∏ –¥–ª—è –ø–µ—Å–æ—á–Ω–∏—Ü—ã –¥–ª—è –∏ –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞, —Ç.–µ. –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –≤–∏–¥–∂–µ—Ç–∞ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –µ–≥–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç.
–ö–æ–Ω—Ñ–∏–≥–∏ –∏–∑ `getDevConfig` –≤ [playground/environmentConfigs.ts](./packages/template/playground/environmentConfigs.ts) –ø–æ–ø–∞–¥–∞—é—Ç –≤ `renderPlayground`. 

**build** ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –≤–∏–¥–∂–µ—Ç –∏ –ø–µ—Å–æ—á–Ω–∏—Ü—É. –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–¥—É—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ. –ù–∞ –≤—ã—Ö–æ–¥–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–∞–ø–∫–∞ dist. –ö —ç—Ç–∏–º —Ñ–∞–π–ª–∞–º –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è stats.html —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –±–∏–ª–¥–µ.

–¢–∏–ø–∏–∑–∞—Ü–∏—é –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∏ start, –Ω–∏ build, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç. –ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –ø–æ–¥–∫–ª—é—á–∏ vite-plugin-checker, –∫–∞–∫ –≤ [–ø—Ä–∏–º–µ—Ä–µ](./packages/template/.platform/config.ts#L8).

–ò start, –∏ build —Å–æ–±–∏—Ä–∞—é—Ç –ø–∞–∫–µ—Ç npm-loader, –≥–æ—Ç–æ–≤—ã–π –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

**preview** ‚Äî –•–æ—Å—Ç–∏—Ç —Å–æ–±—Ä–∞–Ω–Ω—É—é –ø–µ—Å–æ—á–Ω–∏—Ü—É –∏ —Å–∫—Ä–∏–ø—Ç—ã –≤–∏–¥–∂–µ—Ç–∞ –Ω–∞ –æ–¥–Ω–æ–º –ø–æ—Ä—Ç—É. –î–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É production —Å–±–æ—Ä–∫–∏. –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –∫–æ–º–∞–Ω–¥—É **build**.

**watch** - –ó–∞–ø—É—Å–∫–∞–µ—Ç **preview** –∏ **watch** —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

–ù–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ –Ω–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω–æ, –∫—É–¥–∞ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–±–æ—Ä–∫–∏:

```
üì¶Project
 ‚î£ üìÇ.artifacts
 ‚îÉ ‚î£ üìÇcache
 ‚îÉ ‚î£ üìÇnpm-loader
 ‚îÉ ‚î£ üìÇplayground
 ‚îÉ ‚î£ üìÇstats
 ‚îÉ ‚îó üìÇwidget
```

##### –†–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏–∫–∏
`widget-platform` —Ç–æ–ª—å–∫–æ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫—É `.artifacts`. –ß—Ç–æ–±—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏—Ö –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, —Ç–µ–±–µ –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞—Ç–∏–∫–∏.

–°–µ—Ä–≤–µ—Ä —Å—Ç–∞—Ç–∏–∫–∏ –¥–æ–ª–∂–µ–Ω —Ä–∞–∑–¥–∞–≤–∞—Ç—å 2 –ø–∞–ø–∫–∏: `.artifacts/playground` –∏ `.artifacts/widget`. –£—Ä–ª—ã –º–æ–∂–µ—à—å –≤—ã–±–∏—Ä–∞—Ç—å —Å–≤–æ–∏, –Ω–æ —á–∞—Å—Ç–æ –¥–µ–ª–∞—é—Ç —Ç–∞–∫:
- `https://some-url.kontur.ru/[maybe-some-path]/` ‚Äî –ø–∞–ø–∫–∞ `.artifacts/playground`, –≤ –∫–æ—Ä–Ω–µ, —á—Ç–æ–± –¥–æ–ª–≥–æ –Ω–µ –∏—Å–∫–∞—Ç—å.
- `https://some-url.kontur.ru/[maybe-some-path]/widget/` ‚Äî –ø–∞–ø–∫–∞ `.artifacts/widget`.

–û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏ –Ω–µ —Ä–∞–∑–¥–∞–≤–∞–π: —Ç–∞–º –µ—Å—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ —Å–±–æ—Ä–∫–∏, –∫–æ—Ç–æ—Ä—É—é –æ–ø–∞—Å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞—Ä—É–∂—É.

–ï—Å–ª–∏ –ø–∏—à–µ—à—å —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä, —É—á—Ç–∏ —Ç–∞–∫–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:

**–†–∞–∑–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ñ–∞–π–ª–æ–≤ —Å —Ö—ç—à–∞–º–∏ –∏ –±–µ–∑**

–§–∞–π–ª—ã –≤ –ø–∞–ø–∫–∞—Ö `.artifacts/{playground –∏–ª–∏ widget}/assets` —Å —Ö—ç—à–∞–º–∏ –≤ –∏–º–µ–Ω–∏. –ö—ç—à–∏—Ä—É–π –∏—Ö –Ω–∞–≤–µ—á–Ω–æ: `Cache-Control: public, max-age=31536000, immutable`.
–§–∞–π–ª—ã —Å–Ω–∞—Ä—É–∂–∏ `assets` ‚Äî –±–µ–∑ —Ö—ç—à–µ–π. –†–µ–≤–∞–ª–∏–¥–∏—Ä—É–π –∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `Cache-Control: public, no-cache`

**200 –≤–º–µ—Å—Ç–æ 304 –∏–∑-–∑–∞ –µ—Ç–µ–≥–∞**

Nginx –ø–æ–Ω–∏–∂–∞–µ—Ç etag-–∏ –¥–æ weak, –∫–æ–≥–¥–∞ —Å–∂–∏–º–∞–µ—Ç. –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ –ø—Ä–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–∞–π–ª –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —Ç–µ–º –∂–µ, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª, –∏ –≤–º–µ—Å—Ç–æ –±—ã—Å—Ç—Ä–æ–≥–æ 304 —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞–µ—Ç –¥–æ–ª–≥–∏–π 200. 
**–†–µ—à–µ–Ω–∏–µ**: –ó–∏–ø—É–π –≤ —Å–≤–æ–µ–º —Å–µ—Ä–≤–∏—Å–µ, –≤ .NET ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π `UseResponseCompression`.

**404 –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö**

–ß—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–∂–µ—Ç, –Ω—É–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏–∑ –Ω–∏—Ö –∏–º–µ—é—Ç —Ö—ç—à–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ–ª–∏–∑–∞—Ö. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∑–∞ `loader.js` –ø–æ–ø–∞–¥–µ—Ç –Ω–∞ —Ä–µ–ø–ª–∏–∫—É —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π, –∞ `assets/index-1234abcd.js` —É–π–¥–µ—Ç –Ω–∞ —Ä–µ–ø–ª–∏–∫—É —Å–æ —Å—Ç–∞—Ä–æ–π, –æ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ—Ç —Ñ–∞–π–ª —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º, –≤–µ—Ä–Ω–µ—Ç 404 –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–∂–µ—Ç.
**–†–µ—à–µ–Ω–∏–µ**: —Ö—Ä–∞–Ω–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –Ω–æ–≤—É—é, –∏ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –±–∞–Ω–¥–ª–∞. –ù–∞—á–∏–Ω–∞–π —Ä–∞–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –≤—Å–µ —Ä–µ–ø–ª–∏–∫–∏ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å.

###### –í–∏–¥–∂–µ—Ç
–ü—Ä–æ—Å—Ç–æ —Ä–∞–∑–¥–∞–π –ø–∞–ø–∫—É `.artifacts/widget` —Å–≤–æ–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º —Å—Ç–∞—Ç–∏–∫–∏.

###### –ü–ª–µ–π–≥—Ä–∞—É–Ω–¥

–†–∞–∑–¥–∞–π –ø–∞–ø–∫—É `.artifacts/playground` —Å–≤–æ–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º —Å—Ç–∞—Ç–∏–∫–∏.

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å [environmentConfigs.ts](#environmentconfigsts)**, –Ω–∞—É—á–∏ —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑–¥–∞—á–∏ –ø–æ–Ω–∏–º–∞—Ç—å, –≤ –∫–∞–∫–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–ª–µ–π–≥—Ä–∞—É–Ω–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –µ–≥–æ `index.{env}.html`. –û—Å—Ç–∞–ª—å–Ω—ã–µ html-–∫–∏ –Ω—É–∂–Ω–æ –Ω–µ –æ—Ç–¥–∞–≤–∞—Ç—å, –∏–Ω–∞—á–µ –Ω–∞ –ø—Ä–æ–¥–µ –∑–∞—Å–≤–µ—Ç—è—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π.

### –†–∞–±–æ—Ç–∞ —Å window

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤–∏–¥–∂–µ—Ç–æ–≤ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç same-origin iframe. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–Ω—Ç–∞–π–º –≤–∏–¥–∂–µ—Ç–∞, –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ onerror –æ—à–∏–±–∫–∏ –∏ –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å —Å–≤–æ–∏ csp –ø–æ–ª–∏—Ç–∏–∫–∏. –ù–æ —ç—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.

Same-origin iframe –∏—Å–ø–æ–ª–Ω—è–µ—Ç js –∫–æ–¥ –≤–∏–¥–∂–µ—Ç–∞ –≤ –Ω–æ–≤–æ–º iframe –Ω–∞ —Ç–æ–º –∂–µ –¥–æ–º–µ–Ω–µ. –ü—Ä–∏ —ç—Ç–æ–º –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ DOM –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ. –ù—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å —ç—Ç–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ UI –±–∏–±–ª–∏–æ—Ç–µ–∫. –ï—Å–ª–∏ —Ç–∞–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç window –Ω–∞–ø—Ä—è–º—É—é, —Ç–æ –æ–Ω–∞ –ø–æ–ª—É—á–∏—Ç window –Ω–µ —Ä–æ–¥–∏—Ç–µ–ª—è, –∞ –≤–∏–¥–∂–µ—Ç–∞. –¢–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–Ω–æ –æ–±—Ö–æ–¥–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:

–ï—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ window –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `@skbkontur/global-object` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `@skbkontur/react-ui`), —Ç–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å `@skbkontur/global-object` –≤ `sharedModules` —É jsLoader. –¢.–µ. global-object –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è, –∞ –Ω–µ –≤–∏–¥–∂–µ—Ç–∞.

–ï—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `@skbkontur/global-object`, –Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å window, —Ç–æ –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –µ–≥–æ –∫–∞–∫ `@skbkontur/global-object`.

–ï—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å window, —Ç–æ –º–æ–∂–Ω–æ –µ–µ –≤—ã–Ω–µ—Å—Ç–∏ –≤ js-loader. –î–ª—è —ç—Ç–æ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `getJsLoaderDependencies` –≤ —Ñ–∞–π–ª–µ `jsLoader/index.ts`. js-loader –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è, –∞ –∑–Ω–∞—á–∏—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω—É–∂–Ω—ã–π window.

–í—Ç–æ—Ä–æ–π —Å–ø–æ—Å–æ–± —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã - —Ç—Ä–∞–Ω—Å–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ç–∞–∫, —á—Ç–æ–±—ã –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è window —Å—Ç–∞–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@skbkontur/global-object`.

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ï—Å–ª–∏ —Ç—ã —à–∞—Ä–∏—à—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –æ–ø—Ü–∏—é shared, —Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –ò–Ω–∞—á–µ –≤–∏–¥–∂–µ—Ç –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –≤ —Ä–∞–Ω—Ç–∞–π–º–µ. –ß—Ç–æ–±—ã —ç—Ç–æ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ, —Å–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:

1. –£–±–µ—Ä–∏ –∏–∑ shared –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—É—é –æ–±–Ω–æ–≤–ª—è–µ—à—å. –í—ã–ø—É—Å—Ç–∏ –≤–∏–¥–∂–µ—Ç.
2. –û–ø—É–±–ª–∏–∫—É–π –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é npm-loader.
3. –ü–æ–¥–∫–ª—é—á–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é npm-loader.
4. –î–æ–∂–¥–∏—Å—å –≤—ã–ø—É—Å–∫–∞ **–≤—Å–µ—Ö** –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π.
5. –í–µ—Ä–Ω–∏ –≤ shared —Å–≤–æ—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å. –í—ã–ø—É—Å—Ç–∏ –≤–∏–¥–∂–µ—Ç.

–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å? –ï—Å–ª–∏ –∫–æ—Ä–æ—Ç–∫–æ: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º, –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –±–∞–Ω–¥–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ—ç—Ç–æ–º—É –±–µ–∑ –ø–µ—Ä–µ–≤—ã–ø—É—Å–∫–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è, –º—ã –Ω–µ –º–æ–∂–µ–º –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞ –∫–∞–∫ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∞–∂–æ—Ä–Ω—ã—Ö –≤–µ—Ä—Å–∏–π, —Ç–∞–∫ –∏ –ø—Ä–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–∏–Ω–æ—Ä–Ω—ã—Ö. –î–ª—è –º–∏–Ω–æ—Ä–Ω—ã—Ö –≤–µ—Ä—Å–∏–π —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤–æ–µ –∞–ø–∏, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –≤–µ—Ä—Å–∏–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è.

### Roadmap

- [ ] –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- [ ] –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è
- [ ] esm –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### Trubleshooting

- `Transforming destructuring to the configured target environment ("chrome49", "edge112", "firefox102", "ios15.6", "safari15.6" + 2 overrides) is not supported yet`
  –†–µ—à–µ–Ω–∏–µ: –≤ browserslist –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ —Ç–µ –±—Ä–∞—É–∑–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç vite.

- 504 (Outdated Optimize Dep) - –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ —Ç—É –∂–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ –¥—Ä—É–≥–æ–º—É –≤–∏–¥–∂–µ—Ç—É
